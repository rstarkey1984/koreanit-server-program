# Service 흐름과 비즈니스 판단

> **“판단(if)은 어디에 있어야 하는가”** 를 코드로 확실히 구분하고,
> **Service가 비즈니스 로직의 중심**이라는 개념을 이해한다.

---

## 1. 이번 실습에서 확인할 질문

* `if` 는 어디에 있어야 하는가?

---

## 2. 실습 시나리오

### 회원가입 규칙

* username이 `"admin"`이면 가입 불가
* 그 외에는 정상 가입

---

## 3. 잘못된 예 

### ❌ Controller에서 판단하는 경우

```java
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    public void join(String username) {

        if ("admin".equals(username)) {
            System.out.println("가입 불가한 아이디");
            return;
        }

        userService.join(username);
    }
}
```

### 문제점 체크

* 이 규칙은 요청 처리인가?
* 다른 Controller, 다른 진입점에서도 필요하면?
* Controller가 늘어나면 규칙은 어디에 복사되는가?

---

## 4. 올바른 구조

### ✅ 판단은 Service로 이동

```java
public class UserService {

    private final UserRepository userRepository;

    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    public void join(String username) {
        System.out.println("[Service] 회원가입 처리");

        if ("admin".equals(username)) {
            throw new RuntimeException("admin은 사용할 수 없습니다");
        }

        userRepository.save(username);
    }
}
```

Controller는 **요청 전달만** 담당한다.

```java
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    // 사용자의 요청을 받는 메서드
    public void join(String username) {
        System.out.println("[Controller] 회원가입 요청");
        userService.join(username);
        System.out.println("[Controller] 회원가입 요청 처리 완료");
    }
}
```

---

## 5. 역할 기준 다시 정리

### Controller

* 입력 받기
* 요청 전달
* 흐름 제어 ❌
* 판단 ❌

### Service

* 비즈니스 규칙
* 조건 판단
* 성공 / 실패 결정
* 전체 흐름 책임

### Repository

* 저장
* 조회
* 데이터 접근만 담당

---

## 6. 실행 흐름

1. `controller.join("admin")`
2. Service에서 규칙 검사
3. 예외 발생 → 흐름 중단
4. Repository는 호출되지 않음

---

## 7. 스프링과 연결

| 순수 자바                 | 스프링에서             |
| --------------------- | ----------------- |
| Service에 판단 집중        | `@Service`        |
| Controller는 위임만       | `@RestController` |
| 실패 시 RuntimeException | `ApiException`    |
| main에서 호출             | HTTP 요청           |

> 지금은 `RuntimeException`
> → 다음 실습에서 **예외 전용 구조**로 바꾼다

---

## 다음 단계

* `return` vs `throw`
* 예외가 발생하면 **어디까지 실행되는가**
* 실패는 **누가 책임지는가**

→ [**예외 던지기와 흐름 중단**](03.md)


