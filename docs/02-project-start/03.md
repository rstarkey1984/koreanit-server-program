# 예외 던지기와 흐름 중단

> `return`과 `throw`의 차이를 **실행 결과로 체감**하고,
> 실패가 발생했을 때 흐름이 **어디에서 멈추는지** 예측할 수 있어야한다.

---

## 1. 이번 실습에서 확인할 질문

* 예외 메시지는 **누가** 만들고 **누가** 출력하는가?

---

## 2. 프로젝트 구조 (순수 자바)

```text
java-practice/src/
              ├─ App.java
              ├─ UserController.java
              ├─ UserService.java
              └─ UserRepository.java
```

---

## 3. Controller는 그대로 둔다 (요청 전달만)

```java
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    // 사용자의 요청을 받는 메서드
    public void join(String username) {
        System.out.println("[Controller] 회원가입 요청");
        userService.join(username);
        System.out.println("[Controller] 회원가입 요청 처리 완료");
    }
}
```

* Controller는 판단하지 않는다
* Service가 실패를 던지면 Controller는 그 이후 줄이 실행되지 않는다

---

## 4. Service에서 실패를 만든다 (throw)

* username이 `"admin"`이면 가입 불가

```java
public class UserService {

    private final UserRepository userRepository;

    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    public void join(String username) {

        System.out.println("[Service] 회원가입 처리 시작");

        if ("admin".equals(username)) {
            throw new RuntimeException("admin은 사용할 수 없습니다");
        }

        userRepository.save(username);

        System.out.println("[Service] 회원가입 처리 완료");
    }
}
```

* `throw`가 실행되는 순간 아래 코드는 **전부 스킵**
* Repository 호출도 발생하지 않는다

---

## 5. Repository는 저장만 한다

```java
public class UserRepository {

    public void save(String username) {
        System.out.println("[Repository] 사용자 저장: " + username);
    }
}
```

---

## 6. App(main)에서 try-catch로 실패를 책임진다

```java
public class App {

    public static void main(String[] args) {

        UserRepository repo = new UserRepository();
        UserService service = new UserService(repo);
        UserController controller = new UserController(service);

        System.out.println("-- 정상 케이스 --");
        try {
            // 정상 사용자 가입 시도
            controller.join("user1");
        } catch (Exception e) {
            System.out.println("[App] 실패: " + e.getMessage());
        }
        System.out.println("[App] 프로그램 종료");

        System.out.println();

        System.out.println("-- 실패 케이스 --");
        try {
            // "admin" 사용자 가입 시도 (실패 예상)
            controller.join("admin");
        } catch (Exception e) {
            System.out.println("[App] 실패: " + e.getMessage());
        }

        System.out.println("[App] 프로그램 종료");
    }
}
```

---

## 7. 실행 결과 예측

### A. 정상 케이스: `controller.join("user1")`

예상 출력(흐름이 끝까지 감):

```text
-- 정상 케이스 --
[Controller] 회원가입 요청
[Service] 회원가입 처리 시작
[Repository] 사용자 저장: user1
[Service] 회원가입 처리 완료
[Controller] 회원가입 요청 처리 완료
[App] 프로그램 종료
```

### B. 실패 케이스: `controller.join("admin")`

예상 출력(throw 이후는 실행 안 됨):

```text
-- 실패 케이스 --
[Controller] 회원가입 요청
[Service] 회원가입 처리 시작
[App] 실패: admin은 사용할 수 없습니다
[App] 프로그램 종료
```

---

## 8. return vs throw 차이 (핵심)

### return

* **현재 메서드만** 끝낸다
* 호출한 쪽으로 정상 복귀한다
* 이후 줄은 계속 실행된다

### throw

* **현재 메서드를 즉시 중단**한다
* 호출한 쪽으로 예외를 던진다
* 잡힐 때까지(try-catch) 계속 위로 올라간다

---

## 9. 체크 포인트

1. 실패 케이스에서
   `[Repository] 사용자 저장...` 이 출력되는가?

2. 실패 케이스에서
   `[Controller] 회원가입 요청 처리 완료` 가 출력되는가?

3. `try-catch`를 App에서 지우면 프로그램은 어떻게 되는가?

---

## 10. 스프링과 연결

| 지금(순수 자바)                         | 스프링에서                                        |
| --------------------------------- | -------------------------------------------- |
| `App.main()`에서 try-catch로 실패 처리   | `@RestControllerAdvice`가 예외를 잡아 응답 생성        |
| `throw new RuntimeException(...)` | `throw new ApiException(ErrorCode, message)` |
| 콘솔에 메시지 출력                        | JSON 응답으로 변환(상태코드 포함)                        |

> 핵심:
> **순수 자바에서는 main이 예외를 책임지고**,
> **스프링에서는 전역 핸들러가 예외를 책임진다.**

---

## 다음 단계

* Repository를 인터페이스로 분리
* 구현체 교체 실습
* 느슨한 결합의 의미 체감

→ [**인터페이스 도입**](04.md)