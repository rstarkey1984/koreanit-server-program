# Node.js 워커 구현을 위한 핵심 문법 정리

이 문서는  
이후 구현할 Node.js 워커 엔트리포인트(`worker.js`)를  
이해하기 위해 필요한 **최소한의 Node.js / JavaScript 문법만 정리**한다.

이 문서를 기준으로,  
이후 문서에서는 개별 문법 설명을 반복하지 않는다.

---

## 1. Node.js 프로그램의 실행 모델

### 1-1. Node.js는 "서버"가 아니라 "실행기"다

Node.js는 JavaScript를 실행하는 런타임 환경이다.  
HTTP 서버는 선택 사항이며, 워커 프로그램에서는 사용하지 않는다.

워커는 다음 구조를 가진다.

```
실행 → 작업 수행 → 종료
```

실행 예:

```bash
node src/worker.js
```

중요한 특징:

* `main()` 함수가 없다
* **파일 자체가 진입점(entry point)** 이다
* 코드가 **위에서 아래로 즉시 실행**된다

---

## 2. 모듈 시스템 (CommonJS)

### 2-1. CommonJS를 사용하는 이유

이 워커 프로젝트는 CommonJS 방식을 사용한다.

```json
"type": "commonjs"
```

이유:

* Spring의 패키지 / 클래스 구조와 개념적으로 유사
* 파일 단위 책임 분리가 명확
* 의존성 흐름 설명에 유리

---

### 2-2. require는 "불러오기 + 실행 + 캐싱"이다

```js
const pool = require("./db/pool");
```

`require()`의 동작 방식:

1. 파일을 처음 만났을 때 **코드를 실행**
2. `module.exports` 결과를 캐시에 저장
3. 이후 require 시 **같은 객체를 반환**

이로 인해:

* DB 커넥션 풀은 **한 번만 생성**
* 워커 전체에서 **같은 인스턴스를 공유**

> 나중에 "왜 createPool이 여러 번 실행되지 않는가"를 설명하는 근거가 된다.

---

## 3. 비동기 처리 기본 (async / await)

### 3-1. 워커는 비동기 작업의 연속이다

워커에서 수행하는 작업은 대부분 비동기다.

* DB 접근
* 파일 읽기
* 네트워크 요청

기본 형태:

```js
async function run() {
  await job.execute();
}
```

원칙:

* `then / catch` 사용하지 않는다
* 모든 진입 함수는 `async`
* 에러는 처리하지 말고 **그대로 throw**

---

## 4. try-catch의 위치 원칙

워커에서는 `try-catch`를 **엔트리포인트에서만 사용**한다.

```js
try {
  await run();
  process.exit(0);
} catch (err) {
  console.error(err);
  process.exit(1);
}
```

이 구조의 의미:

* 내부 로직은 예외를 **발생시키는 책임만**
* 성공 / 실패 판단은 **최상위에서만**
* 워커의 결과는 **종료 코드로 표현**

---

## 5. process 객체와 종료 코드

### 5-1. exit code가 중요한 이유

워커는 보통 다음 환경에서 실행된다.

* cron
* CI/CD
* 운영 스크립트
* 수동 배치 실행

```js
process.exit(0); // 정상 종료
process.exit(1); // 실패 종료
```

중요한 점:

* 로그 메시지는 참고용
* **성공 / 실패의 기준은 종료 코드**

---

## 6. 환경 변수와 dotenv

워커의 설정값은 코드에 하드코딩하지 않는다.

```js
require("dotenv").config();
```

원칙:

* `.env`는 실행 환경의 책임
* 코드와 설정 분리
* 서버와 워커 설정을 명확히 분리

---

## 7. 이 문서에서 다루지 않는 것

이 문서에서는 다음 내용을 다루지 않는다.

* JavaScript 문법 상세
* 클래스 / prototype
* 이벤트 루프 이론
* Express / HTTP 서버

> 목적은 언어 학습이 아니라 **워커 구조 이해**다.

---

## 다음 단계

다음 문서에서는  
지금 정리한 문법을 전제로,  
Node.js 워커의 실제 엔트리포인트(`worker.js`)를 구현한다.

→ [**워커 엔트리포인트 구현**](03-worker_entrypoint.md)
