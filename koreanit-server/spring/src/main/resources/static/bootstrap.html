<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bootstrap + Vue3 API Client</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.8/dist/axios.min.js"></script>

  <style>
    body {
      background: #f7f7f9;
    }

    pre {
      max-height: 260px;
      overflow: auto;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
  </style>
</head>

<body>
  <div id="app" class="container py-4">

    <div class="d-flex align-items-center justify-content-between mb-3">
      <div>
        <h3 class="mb-0">API Client</h3>
        <div class="text-muted small">
          Base URL:
          <span class="mono">{{ baseUrl }}</span>
        </div>
      </div>
      <div class="d-flex gap-2">
        <input class="form-control form-control-sm mono" style="width: 320px" v-model="baseUrl"
          placeholder="http://localhost:8080" />
        <button class="btn btn-sm btn-outline-secondary" @click="applyBaseUrl">
          적용
        </button>
      </div>
    </div>

    <!-- Alerts -->
    <div v-if="alert.show" class="alert" :class="alert.type" role="alert">
      <div class="d-flex justify-content-between align-items-start">
        <div class="me-3">{{ alert.message }}</div>
        <button class="btn btn-sm btn-outline-dark" @click="alert.show=false">닫기</button>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <button class="nav-link" :class="{active: tab==='auth'}" @click="tab='auth'">Auth</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" :class="{active: tab==='posts'}" @click="tab='posts'">Posts</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" :class="{active: tab==='users'}" @click="tab='users'">Users</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" :class="{active: tab==='raw'}" @click="tab='raw'">Raw</button>
      </li>
    </ul>

    <!-- AUTH -->
    <div v-show="tab==='auth'" class="row g-3">
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header fw-semibold">로그인</div>
          <div class="card-body">
            <div class="mb-2">
              <label class="form-label">username</label>
              <input class="form-control mono" v-model.trim="auth.username" placeholder="user1" />
            </div>
            <div class="mb-3">
              <label class="form-label">password</label>
              <input class="form-control mono" type="password" v-model="auth.password" placeholder="1234" />
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-primary" @click="login" :disabled="busy">로그인</button>
              <button class="btn btn-outline-secondary" @click="logout" :disabled="busy">로그아웃</button>
              <button class="btn btn-outline-dark" @click="me" :disabled="busy">/me</button>
            </div>
            <div class="mt-3 small text-muted">
              세션 기반이면 브라우저 쿠키가 유지되어야 합니다. (Axios withCredentials 사용)
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header fw-semibold">현재 로그인 사용자</div>
          <div class="card-body">
            <div v-if="meData" class="mb-2">
              <div class="mb-1"><span class="text-muted">id</span>: <span class="mono">{{ meData.id }}</span></div>
              <div class="mb-1"><span class="text-muted">username</span>: <span class="mono">{{ meData.username
                  }}</span></div>
              <div class="mb-1"><span class="text-muted">email</span>: <span class="mono">{{ meData.email }}</span>
              </div>
              <div class="mb-1"><span class="text-muted">nickname</span>: <span class="mono">{{ meData.nickname
                  }}</span></div>
              <div class="mb-1"><span class="text-muted">role</span>: <span class="mono">{{ meData.role }}</span></div>
            </div>
            <div v-else class="text-muted">/api/me 호출 결과가 여기에 표시됩니다.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- POSTS -->
    <div v-show="tab==='posts'" class="row g-3">
      <div class="col-lg-5">
        <div class="card shadow-sm">
          <div class="card-header fw-semibold d-flex justify-content-between align-items-center">
            <span>게시글 목록</span>
            <div class="d-flex gap-2 align-items-center">
              <input class="form-control form-control-sm mono" style="width: 90px" v-model.number="posts.query.page"
                type="number" min="1" />
              <input class="form-control form-control-sm mono" style="width: 90px" v-model.number="posts.query.limit"
                type="number" min="1" />
              <button class="btn btn-sm btn-outline-primary" @click="fetchPosts" :disabled="busy">조회</button>
            </div>
          </div>
          <div class="card-body p-0">
            <div v-if="posts.list.length===0" class="p-3 text-muted">목록이 비어있습니다.</div>
            <div class="list-group list-group-flush">
              <button v-for="p in posts.list" :key="p.id" class="list-group-item list-group-item-action"
                @click="selectPost(p.id)">
                <div class="d-flex justify-content-between">
                  <div class="fw-semibold text-truncate me-2">{{ p.title }}</div>
                  <div class="text-muted mono">#{{ p.id }}</div>
                </div>
                <div class="small text-muted d-flex gap-2">
                  <span class="mono">views={{ p.viewCount ?? p.view_count ?? '-' }}</span>
                  <span class="mono">comments={{ p.commentsCnt ?? p.comments_cnt ?? '-' }}</span>
                </div>
              </button>
            </div>
          </div>
        </div>

        <div class="card shadow-sm mt-3">
          <div class="card-header fw-semibold">게시글 작성</div>
          <div class="card-body">
            <div class="mb-2">
              <label class="form-label">title</label>
              <input class="form-control" v-model.trim="posts.create.title" placeholder="제목" />
            </div>
            <div class="mb-3">
              <label class="form-label">content</label>
              <textarea class="form-control" rows="4" v-model.trim="posts.create.content" placeholder="내용"></textarea>
            </div>
            <button class="btn btn-primary" @click="createPost" :disabled="busy">작성</button>
            <div class="small text-muted mt-2">
              인증 필요: POST /api/posts
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-7">
        <div class="card shadow-sm">
          <div class="card-header fw-semibold d-flex justify-content-between align-items-center">
            <span>게시글 단건</span>
            <div class="d-flex gap-2">
              <input class="form-control form-control-sm mono" style="width: 120px" v-model.number="posts.selectedId"
                type="number" min="1" placeholder="id" />
              <button class="btn btn-sm btn-outline-dark" @click="getPost(posts.selectedId)"
                :disabled="busy || !posts.selectedId">조회</button>
            </div>
          </div>
          <div class="card-body">
            <div v-if="posts.detail">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h5 class="mb-1">{{ posts.detail.title }}</h5>
                  <div class="text-muted small mono">
                    id={{ posts.detail.id }},
                    userId={{ posts.detail.userId ?? posts.detail.user_id ?? '-' }},
                    views={{ posts.detail.viewCount ?? posts.detail.view_count ?? '-' }},
                    comments={{ posts.detail.commentsCnt ?? posts.detail.comments_cnt ?? '-' }}
                  </div>
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-outline-danger btn-sm" @click="deletePost(posts.detail.id)" :disabled="busy">
                    삭제
                  </button>
                </div>
              </div>

              <div class="mb-3">
                <div class="fw-semibold mb-1">content</div>
                <div class="border rounded p-2 bg-light">{{ posts.detail.content }}</div>
              </div>

              <hr />

              <div class="row g-3">
                <div class="col-md-6">
                  <div class="fw-semibold mb-2">게시글 수정</div>
                  <div class="mb-2">
                    <label class="form-label">title</label>
                    <input class="form-control" v-model.trim="posts.update.title" />
                  </div>
                  <div class="mb-2">
                    <label class="form-label">content</label>
                    <textarea class="form-control" rows="4" v-model.trim="posts.update.content"></textarea>
                  </div>
                  <button class="btn btn-outline-primary" @click="updatePost(posts.detail.id)" :disabled="busy">
                    수정
                  </button>
                  <div class="small text-muted mt-2">
                    작성자 또는 관리자: PUT /api/posts/{id}
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="fw-semibold mb-2">댓글</div>

                  <div class="d-flex gap-2 mb-2">
                    <input class="form-control form-control-sm mono" style="width: 120px"
                      v-model.number="comments.query.before" type="number" placeholder="before(id)" />
                    <input class="form-control form-control-sm mono" style="width: 90px"
                      v-model.number="comments.query.limit" type="number" min="1" />
                    <button class="btn btn-sm btn-outline-secondary" @click="fetchComments(posts.detail.id)"
                      :disabled="busy">
                      목록
                    </button>
                  </div>

                  <div class="mb-2">
                    <textarea class="form-control" rows="2" v-model.trim="comments.create.content"
                      placeholder="댓글 내용"></textarea>
                  </div>
                  <button class="btn btn-sm btn-primary mb-3" @click="createComment(posts.detail.id)" :disabled="busy">
                    댓글 작성
                  </button>

                  <div v-if="comments.list.length===0" class="text-muted small">댓글이 없습니다.</div>
                  <div v-else class="list-group">
                    <div v-for="c in comments.list" :key="c.id" class="list-group-item">
                      <div class="d-flex justify-content-between">
                        <div class="mono small text-muted">
                          #{{ c.id }} userId={{ c.userId ?? c.user_id ?? '-' }}
                        </div>
                        <button class="btn btn-sm btn-outline-danger" @click="deleteComment(c.id, posts.detail.id)"
                          :disabled="busy">
                          삭제
                        </button>
                      </div>
                      <div class="mt-1">{{ c.content }}</div>
                      <div class="mono small text-muted mt-1">
                        createdAt={{ c.createdAt ?? c.created_at ?? '-' }}
                      </div>
                    </div>
                  </div>

                  <div class="small text-muted mt-2">
                    목록: GET /api/posts/{postId}/comments?before=&limit= <br />
                    삭제: DELETE /api/comments/{id}
                  </div>
                </div>
              </div>
            </div>

            <div v-else class="text-muted">
              왼쪽에서 게시글을 선택하거나 id로 조회하세요.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- USERS -->
    <div v-show="tab==='users'" class="row g-3">
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header fw-semibold d-flex justify-content-between align-items-center">
            <span>회원가입</span>
            <span class="small text-muted">POST /api/users</span>
          </div>
          <div class="card-body">
            <div class="mb-2">
              <label class="form-label">username</label>
              <input class="form-control mono" v-model.trim="users.create.username" />
            </div>
            <div class="mb-2">
              <label class="form-label">password</label>
              <input class="form-control mono" type="password" v-model="users.create.password" />
            </div>
            <div class="mb-2">
              <label class="form-label">email</label>
              <input class="form-control mono" v-model.trim="users.create.email" />
            </div>
            <div class="mb-3">
              <label class="form-label">nickname</label>
              <input class="form-control mono" v-model.trim="users.create.nickname" />
            </div>
            <button class="btn btn-primary" @click="signup" :disabled="busy">회원가입</button>
            <div class="small text-muted mt-2">
              중복이면 409, 검증 실패면 400
            </div>
          </div>
        </div>

        <div class="card shadow-sm mt-3">
          <div class="card-header fw-semibold d-flex justify-content-between align-items-center">
            <span>회원 목록(관리자)</span>
            <div class="d-flex gap-2 align-items-center">
              <input class="form-control form-control-sm mono" style="width: 120px" v-model.number="users.query.limit"
                type="number" min="1" />
              <button class="btn btn-sm btn-outline-primary" @click="fetchUsers" :disabled="busy">조회</button>
            </div>
          </div>
          <div class="card-body p-0">
            <div v-if="users.list.length===0" class="p-3 text-muted">목록이 비어있습니다.</div>
            <div class="list-group list-group-flush">
              <button v-for="u in users.list" :key="u.id" class="list-group-item list-group-item-action"
                @click="selectUser(u.id)">
                <div class="d-flex justify-content-between">
                  <div class="fw-semibold">{{ u.username }}</div>
                  <div class="text-muted mono">#{{ u.id }}</div>
                </div>
                <div class="small text-muted mono">
                  email={{ u.email ?? '-' }} nickname={{ u.nickname ?? '-' }} role={{ u.role ?? '-' }}
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header fw-semibold d-flex justify-content-between align-items-center">
            <span>회원 단건(관리자)</span>
            <div class="d-flex gap-2">
              <input class="form-control form-control-sm mono" style="width: 120px" v-model.number="users.selectedId"
                type="number" min="1" placeholder="id" />
              <button class="btn btn-sm btn-outline-dark" @click="getUser(users.selectedId)"
                :disabled="busy || !users.selectedId">
                조회
              </button>
            </div>
          </div>
          <div class="card-body">
            <div v-if="users.detail">
              <div class="mb-1"><span class="text-muted">id</span>: <span class="mono">{{ users.detail.id }}</span>
              </div>
              <div class="mb-1"><span class="text-muted">username</span>: <span class="mono">{{ users.detail.username
                  }}</span></div>
              <div class="mb-1"><span class="text-muted">email</span>: <span class="mono">{{ users.detail.email
                  }}</span></div>
              <div class="mb-1"><span class="text-muted">nickname</span>: <span class="mono">{{ users.detail.nickname
                  }}</span></div>
              <div class="mb-3"><span class="text-muted">role</span>: <span class="mono">{{ users.detail.role }}</span>
              </div>

              <div class="d-flex gap-2">
                <button class="btn btn-outline-danger" @click="deleteUser(users.detail.id)" :disabled="busy">삭제</button>
              </div>

              <hr />

              <div class="row g-2">
                <div class="col-12">
                  <div class="fw-semibold mb-1">닉네임 변경</div>
                  <div class="input-group">
                    <input class="form-control mono" v-model.trim="users.change.nickname" placeholder="new nickname" />
                    <button class="btn btn-outline-primary" @click="changeNickname(users.detail.id)"
                      :disabled="busy">변경</button>
                  </div>
                </div>
                <div class="col-12">
                  <div class="fw-semibold mb-1">이메일 변경</div>
                  <div class="input-group">
                    <input class="form-control mono" v-model.trim="users.change.email" placeholder="new email" />
                    <button class="btn btn-outline-primary" @click="changeEmail(users.detail.id)"
                      :disabled="busy">변경</button>
                  </div>
                </div>
                <div class="col-12">
                  <div class="fw-semibold mb-1">비밀번호 변경</div>
                  <div class="input-group">
                    <input class="form-control mono" type="password" v-model="users.change.password"
                      placeholder="new password" />
                    <button class="btn btn-outline-primary" @click="changePassword(users.detail.id)"
                      :disabled="busy">변경</button>
                  </div>
                </div>
              </div>

              <div class="small text-muted mt-3">
                변경 API는 "본인 또는 관리자" 정책일 수 있습니다.
              </div>
            </div>
            <div v-else class="text-muted">
              좌측 목록에서 선택하거나 id로 조회하세요.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RAW -->
    <div v-show="tab==='raw'" class="row g-3">
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header fw-semibold">Raw Request</div>
          <div class="card-body">
            <div class="mb-2">
              <label class="form-label">Method</label>
              <select class="form-select mono" v-model="raw.method">
                <option>GET</option>
                <option>POST</option>
                <option>PUT</option>
                <option>DELETE</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Path (예: /api/posts)</label>
              <input class="form-control mono" v-model.trim="raw.path" placeholder="/api/posts" />
            </div>
            <div class="mb-3">
              <label class="form-label">JSON Body</label>
              <textarea class="form-control mono" rows="8" v-model="raw.body"></textarea>
            </div>
            <button class="btn btn-outline-primary" @click="sendRaw" :disabled="busy">전송</button>
            <div class="small text-muted mt-2">
              세션 인증이면 쿠키가 유지되어야 합니다.
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header fw-semibold">Last Response</div>
          <div class="card-body">
            <div class="mb-2 text-muted small mono">
              status={{ last.status ?? '-' }}
            </div>
            <pre class="bg-light border rounded p-2 mono">{{ pretty(last.data) }}</pre>
            <div class="small text-muted">
              에러일 때도 Axios 응답/에러 내용을 최대한 보여줍니다.
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          tab: 'auth',
          baseUrl: 'http://localhost:8080',
          api: null,
          busy: false,

          alert: { show: false, type: 'alert-info', message: '' },
          last: { status: null, data: null },

          auth: { username: '', password: '' },
          meData: null,

          posts: {
            query: { page: 1, limit: 20 },
            list: [],
            selectedId: null,
            detail: null,
            create: { title: '', content: '' },
            update: { title: '', content: '' }
          },

          comments: {
            query: { before: null, limit: 20 },
            list: [],
            create: { content: '' }
          },

          users: {
            query: { limit: 50 },
            list: [],
            selectedId: null,
            detail: null,
            create: { username: '', password: '', email: '', nickname: '' },
            change: { nickname: '', email: '', password: '' }
          },

          raw: { method: 'GET', path: '/api/posts', body: '{\n  \n}' }
        };
      },

      mounted() {
        this.applyBaseUrl();
      },

      methods: {
        applyBaseUrl() {
          this.api = axios.create({
            baseURL: this.baseUrl,
            withCredentials: true, // 세션(쿠키) 전송
            headers: { 'Content-Type': 'application/json' }
          });

          this.toast('alert-info', 'Base URL 적용 완료');
        },

        toast(type, msg) {
          this.alert.type = type;
          this.alert.message = msg;
          this.alert.show = true;
        },

        pretty(v) {
          try { return JSON.stringify(v, null, 2); }
          catch (e) { return String(v); }
        },

        unwrap(resData) {
          // {success, data} 형태면 data 반환, 아니면 전체 반환
          if (resData && typeof resData === 'object' && 'success' in resData) {
            if (resData.success) return resData.data;
            // 실패 포맷이면 error 전체 반환
            return resData;
          }
          return resData;
        },

        setLast(responseOrError) {
          if (responseOrError && responseOrError.response) {
            // Axios error
            this.last.status = responseOrError.response.status;
            this.last.data = responseOrError.response.data;
          } else if (responseOrError) {
            // Axios response
            this.last.status = responseOrError.status;
            this.last.data = responseOrError.data;
          } else {
            this.last.status = null;
            this.last.data = null;
          }
        },

        async safeCall(fn) {
          this.busy = true;
          try {
            const res = await fn();
            this.setLast(res);
            return res;
          } catch (e) {
            this.setLast(e);

            const status = e?.response?.status;
            const body = e?.response?.data;
            const msg = body?.message || e?.message || `HTTP ${status ?? ''} 요청 실패`;
            const code = body?.code;

            this.toast('alert-danger', code ? `${code}: ${msg}` : msg);
            return null;
          }
          finally {
            this.busy = false;
          }
        },

        // Auth
        async login() {
          const payload = { username: this.auth.username, password: this.auth.password };
          const res = await this.safeCall(() => this.api.post('/api/login', payload));
          if (!res) return;
          const data = this.unwrap(res.data);
          this.meData = data;
          this.toast('alert-success', '로그인 성공');
        },

        async logout() {
          const res = await this.safeCall(() => this.api.post('/api/logout'));
          if (!res) return;
          this.meData = null;
          this.toast('alert-success', '로그아웃 완료');
        },

        async me() {
          const res = await this.safeCall(() => this.api.get('/api/me'));
          if (!res) return;
          this.meData = this.unwrap(res.data);
          this.toast('alert-info', '/me 조회 완료');
        },

        // Posts
        async fetchPosts() {
          const { page, limit } = this.posts.query;
          const res = await this.safeCall(() => this.api.get('/api/posts', { params: { page, limit } }));
          if (!res) return;

          const data = this.unwrap(res.data);
          this.posts.list = Array.isArray(data) ? data : (data?.items ?? data?.list ?? []);
          this.toast('alert-info', `게시글 목록 ${this.posts.list.length}건`);
        },

        async selectPost(id) {
          this.posts.selectedId = id;
          await this.getPost(id);
        },

        async getPost(id) {
          if (!id) return;
          const res = await this.safeCall(() => this.api.get(`/api/posts/${id}`));
          if (!res) return;

          const data = this.unwrap(res.data);
          this.posts.detail = data;
          this.posts.update.title = data?.title ?? '';
          this.posts.update.content = data?.content ?? '';
          // 댓글은 자동으로도 불러오도록
          await this.fetchComments(id);
          this.toast('alert-info', `게시글 #${id} 조회 완료`);
        },

        async createPost() {
          const payload = { title: this.posts.create.title, content: this.posts.create.content };
          const res = await this.safeCall(() => this.api.post('/api/posts', payload));
          if (!res) return;

          const created = this.unwrap(res.data);
          this.toast('alert-success', '게시글 작성 완료');
          this.posts.create.title = '';
          this.posts.create.content = '';
          await this.fetchPosts();
          if (created?.id) await this.getPost(created.id);
        },

        async updatePost(id) {
          const payload = { title: this.posts.update.title, content: this.posts.update.content };
          const res = await this.safeCall(() => this.api.put(`/api/posts/${id}`, payload));
          if (!res) return;

          this.toast('alert-success', '게시글 수정 완료');
          await this.getPost(id);
          await this.fetchPosts();
        },

        async deletePost(id) {
          if (!confirm(`게시글 #${id} 삭제할까요?`)) return;
          const res = await this.safeCall(() => this.api.delete(`/api/posts/${id}`));
          if (!res) return;

          this.toast('alert-success', '게시글 삭제 완료');
          this.posts.detail = null;
          await this.fetchPosts();
        },

        // Comments
        async fetchComments(postId) {
          const params = { limit: this.comments.query.limit };
          if (this.comments.query.before) params.before = this.comments.query.before;

          const res = await this.safeCall(() => this.api.get(`/api/posts/${postId}/comments`, { params }));
          if (!res) return;

          const data = this.unwrap(res.data);
          this.comments.list = Array.isArray(data) ? data : (data?.items ?? data?.list ?? []);
        },

        async createComment(postId) {
          const payload = { content: this.comments.create.content };
          const res = await this.safeCall(() => this.api.post(`/api/posts/${postId}/comments`, payload));
          if (!res) return;

          this.toast('alert-success', '댓글 작성 완료');
          this.comments.create.content = '';
          await this.fetchComments(postId);
          await this.getPost(postId); // comments_cnt 갱신
        },

        async deleteComment(id, postId) {
          if (!confirm(`댓글 #${id} 삭제할까요?`)) return;
          const res = await this.safeCall(() => this.api.delete(`/api/comments/${id}`));
          if (!res) return;

          this.toast('alert-success', '댓글 삭제 완료');
          await this.fetchComments(postId);
          await this.getPost(postId); // comments_cnt 갱신
        },

        // Users
        async signup() {
          const payload = { ...this.users.create };
          const res = await this.safeCall(() => this.api.post('/api/users', payload));
          if (!res) return;

          this.toast('alert-success', '회원가입 완료');
          this.users.create = { username: '', password: '', email: '', nickname: '' };
        },

        async fetchUsers() {
          const res = await this.safeCall(() => this.api.get('/api/users', { params: { limit: this.users.query.limit } }));
          if (!res) return;

          const data = this.unwrap(res.data);
          this.users.list = Array.isArray(data) ? data : (data?.items ?? data?.list ?? []);
          this.toast('alert-info', `회원 목록 ${this.users.list.length}건`);
        },

        async selectUser(id) {
          this.users.selectedId = id;
          await this.getUser(id);
        },

        async getUser(id) {
          if (!id) return;
          const res = await this.safeCall(() => this.api.get(`/api/users/${id}`));
          if (!res) return;

          this.users.detail = this.unwrap(res.data);
          this.toast('alert-info', `회원 #${id} 조회 완료`);
        },

        async deleteUser(id) {
          if (!confirm(`회원 #${id} 삭제할까요?`)) return;
          const res = await this.safeCall(() => this.api.delete(`/api/users/${id}`));
          if (!res) return;

          this.toast('alert-success', '회원 삭제 완료');
          this.users.detail = null;
          await this.fetchUsers();
        },

        async changeNickname(id) {
          const payload = { nickname: this.users.change.nickname };
          const res = await this.safeCall(() => this.api.put(`/api/users/${id}/nickname`, payload));
          if (!res) return;
          this.toast('alert-success', '닉네임 변경 완료');
          await this.getUser(id);
        },

        async changeEmail(id) {
          const payload = { email: this.users.change.email };
          const res = await this.safeCall(() => this.api.put(`/api/users/${id}/email`, payload));
          if (!res) return;
          this.toast('alert-success', '이메일 변경 완료');
          await this.getUser(id);
        },

        async changePassword(id) {
          const payload = { password: this.users.change.password };
          const res = await this.safeCall(() => this.api.put(`/api/users/${id}/password`, payload));
          if (!res) return;
          this.toast('alert-success', '비밀번호 변경 완료');
          // 보안상 화면에 그대로 반영할 건 없음
        },

        // Raw
        async sendRaw() {
          const method = this.raw.method.toLowerCase();
          const url = this.raw.path.startsWith('/') ? this.raw.path : `/${this.raw.path}`;

          let data = undefined;
          if (['post', 'put', 'patch'].includes(method)) {
            try {
              data = this.raw.body?.trim() ? JSON.parse(this.raw.body) : {};
            } catch (e) {
              this.toast('alert-danger', 'JSON Body 파싱 실패');
              return;
            }
          }

          const res = await this.safeCall(() => this.api.request({ method, url, data }));
          if (!res) return;

          this.toast('alert-success', 'Raw 요청 완료');
        }
      }
    }).mount('#app');
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>