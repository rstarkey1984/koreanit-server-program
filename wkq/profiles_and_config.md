# 환경별 설정 분리

이 장에서는
서버 프로그램에서 **환경(environment)에 따라 설정을 분리하는 이유와 기준**을 정한다.

앞 장까지 공통 모듈을 통해
응답, 에러, 로깅 규칙을 정리했다면,
이제는 **실행 환경에 따라 달라져야 하는 값들을 어떻게 관리할지**를 다룬다.


---

## 1. 서버는 항상 같은 환경에서 실행되지 않는다

서버 프로그램은
하나의 환경에서만 실행되지 않는다.

일반적으로 다음과 같은 환경을 가진다.

* 개발 환경 (development)
* 운영 환경 (production)

같은 코드라도
실행되는 환경에 따라 설정은 달라져야 한다.

---

## 2. 환경에 따라 달라지는 것들

환경에 따라 달라지는 대표적인 설정은 다음과 같다.

* DB 접속 정보
* 로그 레벨
* 외부 API 주소
* 포트 번호

이 값들을 코드에 직접 적어두면
환경 전환이 매우 어려워진다.

---

## 3. 코드와 설정을 분리해야 하는 이유

코드와 설정이 섞이면
다음 문제가 발생한다.

* 환경 변경 시 코드 수정 필요
* 실수로 운영 설정을 커밋할 위험
* 재배포 없이 설정 변경 불가

그래서 서버에서는
**코드는 고정하고, 설정만 바꾸는 구조**를 만든다.

---

## 4. 환경별 설정 파일 개념

Spring 기반 서버에서는
환경별 설정 파일을 사용한다.

개념 예시:

```text
application.yml
application-dev.yml
application-prod.yml
```

실행 환경에 따라
적절한 설정 파일이 선택된다.

---

## 5. 환경 선택 흐름 (개념)

서버 실행 시:

```text
실행 환경 지정
  ↓
환경에 맞는 설정 로드
  ↓
서버 실행
```

이 구조가 만들어지면
같은 코드로 여러 환경을 운영할 수 있다.

---

## 6. 지금 단계에서 하지 않는 것

이 장에서는 다음을 다루지 않는다.

* 비밀 정보 관리 전략 심화
* 외부 설정 서버
* Docker / Kubernetes 환경 변수 주입

지금 단계의 목표는
**환경 분리의 필요성과 기본 동작을 직접 확인하는 것**이다.

---

## 이 장의 핵심 정리

* 서버는 여러 환경에서 실행된다
* 환경에 따라 설정은 달라져야 한다
* 코드는 고정하고 설정만 바꾼다
* 설정 분리는 운영 안정성의 기본이다

---

## 실습 목표

* 환경별 설정 파일을 직접 분리해본다
* 실행 환경에 따라 다른 설정이 적용되는 것을 확인한다
* 코드 수정 없이 환경을 전환하는 경험을 한다

---

## 실습 준비

* Spring Boot 프로젝트
* 기본 `application.yml` 존재

---

## 실습 과제

### 1단계: 환경별 설정 파일 생성

다음 파일을 생성한다.

```text
src/main/resources/
  application.yml
  application-dev.yml
  application-prod.yml
```

예시 내용:

```yaml
# application.yml (공통)
spring:
  profiles:
    active: dev
```

```yaml
# application-dev.yml
server:
  port: 8080

logging:
  level:
    root: DEBUG
```

```yaml
# application-prod.yml
server:
  port: 8081

logging:
  level:
    root: INFO
```

---

### 2단계: 실행 환경 변경

실행 옵션으로 활성 프로파일을 변경한다.

예:

```bash
# 개발 단계 실행 (권장)
SPRING_PROFILES_ACTIVE=prod ./gradlew bootRun

# 또는
./gradlew bootRun --args='--spring.profiles.active=prod'
```

---

### 3단계: 동작 확인

* dev 환경 실행 → 8080 포트 확인
* prod 환경 실행 → 8081 포트 확인
* 로그 출력 레벨 차이 확인

---

## 체크 포인트

* 코드 수정 없이 환경이 전환되는가?
* 설정 값이 환경별로 분리되어 있는가?
* 운영 설정이 코드에 섞여 있지 않은가?

---

## 다음 단계

→ [**Batch / Worker 아키텍처 개요**](06-main_vs_worker_architecture.md)
